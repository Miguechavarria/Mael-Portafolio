<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mael | Diseño Interactivo</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Contrail+One&family=Poppins:wght@300;400;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="noise-overlay"></div><div class="glitch-effect-wrapper">
        <div class="glitch__img"></div><div class="glitch__img"></div><div class="glitch__img"></div><div class="glitch__img"></div><div class="glitch__img"></div>
    </div>

    <div id="page-transition-overlay" class="overlay"></div>
    <div id="loader" class="loader"></div>

    <div id="main-content" class="hidden">

        <button class="menu-btn" aria-label="Abrir menú" aria-expanded="false">☰</button>

        <nav class="circular-menu" aria-hidden="true" aria-label="Menú principal">
            <ul>
                <li class="circular-item" data-angle="-60"><a href="index.html">Inicio</a></li>
                <li class="circular-item" data-angle="-20"><a href="portafolio.html">Portafolio</a></li>
                <li class="circular-item" data-angle="20"><a href="acerca.html">Acerca de Mí</a></li>
                <li class="circular-item" data-angle="60"><a href="contacto.html">Contacto</a></li>
            </ul>
        </nav>
        
        <main class="neo-brutalist-grid">
            
            <div id="webgl-output"></div> 
            
            <aside class="graphic-panel">
                <section class="hero neo-brutalist-hero">
                     <h1>MAEL</h1>
                     <p>Diseñador Interactivo</p>
                </section>

                <div class="panel-item panel-sunburst">
                    <div class="sunburst-icon"></div>
                </div>
                <div class="panel-item panel-title-block">
                    <span class="japanese-char">ᚢᛉᚨᚺᛃᚦᛁᚷ</span>
                    <p class="small-text">Miguel Echavarria</p>
                </div>
                <div class="panel-item panel-circles">
                    <span class="circle"></span><span class="circle"></span><span class="circle"></span><span class="circle"></span><span class="circle"></span><span class="circle"></span>
                </div>
                <div class="panel-item panel-pill-grid">
                    <div class="pill-outline"></div>
                </div>
                <div class="panel-item panel-pill-lines">
                    <div class="pill-outline"></div>
                </div>
                <div class="panel-item panel-text-vertical">
                    <p>力は目覚め守られる<br>言葉となり試練を越え<br>循環は終わり再び生まれ<br>氷と贈り物により均衡する</p>
            </div>

                <div class="panel-item panel-social-pointer">
                    <div class="panel-chevron-icon">
                        <svg viewBox="0 0 24 24"><path fill="currentColor" d="M12,18.26L4.94,11.2L7.06,9.08L12,14L16.94,9.08L19.06,11.2M12,21L.94,9.94L3.06,7.82L12,16.76L20.94,7.82L23.06,9.94Z" /></svg>
                    </div>
                    <div class="social-icons neo-brutalist-social">
                         <a href="#" class="social-icon" aria-label="GitHub"><img src="assets/x_icon.png" alt="GitHub"></a>
                         <a href="#" class="social-icon" aria-label="LinkedIn"><img src="assets/instagram_icon.png" alt="LinkedIn"></a>
                         <a href="#" class="social-icon" aria-label="Behance"><img src="assets/facebook_icon.png" alt="Behance"></a>
                    </div>
                </div>
                <div class="panel-item panel-text-block">
                    <p>WEB DESIGN<br>INTERACTIVE PROTOTYPING<br>FRONT-END DEVELOPMENT</p>
                </div>
            </aside>
        </main>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

   <script>
    document.addEventListener('DOMContentLoaded', () => {
        const meshContainer = document.getElementById('webgl-output');
        if (!meshContainer) return;

        let scene, camera, renderer, mesh;
        let mouse = new THREE.Vector2();
        let clickStrength = 0;
        let containerRect = meshContainer.getBoundingClientRect();
        
        const TERRAIN_PARAMS = {
            width: 60,
            height: 60,
            segmentsX: 160,
            segmentsY: 160,
            noiseFactor: 15,
            heightFactor: 3.8,
            animSpeed: 0.0025
        };

        // --- INICIO: GENERADOR DE RUIDO PERLIN ---
        const noise = new function() {
            this.p = new Uint8Array(512);
            const permutation = [ 151,160,137,91,90,15,
            131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,
            190, 6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,
            88,237,149,56,87,174,20,125,136,171,168, 68,175,74,165,71,134,139,48,27,166,
            77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,
            102,143,54, 65,25,63,161, 1,216,80,73,209,76,132,187,208, 89,18,169,200,196,
            135,130,116,188,159,86,164,100,109,198,173,186, 3,64,52,217,226,250,124,123,
            5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,
            223,183,170,213,119,248,152, 2,44,154,163, 70,221,153,101,155,167, 43,172,9,
            129,22,39,253, 19,98,108,110,79,113,224,232,178,185, 112,104,218,246,97,228,
            251,34,242,193,238,210,144,12,191,179,162,241, 81,51,145,235,249,14,239,107,
            49,192,214, 31,181,199,106,157,184, 84,204,176,115,121,50,45,127, 4,150,254,
            138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180 ];
            for (let i=0; i < 256 ; i++) this.p[i] = this.p[i+256] = permutation[i]; 
            function fade(t) { return t*t*t*(t*(t*6-15)+10); }
            function lerp(t, a, b) { return a + t * (b - a); }
            function grad(hash, x, y, z) {
                let h = hash & 15;
                let u = h < 8 ? x : y, v = h < 4 ? y : h === 12 || h === 14 ? x : z;
                return ((h&1) === 0 ? u : -u) + ((h&2) === 0 ? v : -v);
            }
            this.perlin3 = function (x, y, z) {
                let X = Math.floor(x) & 255, Y = Math.floor(y) & 255, Z = Math.floor(z) & 255;
                x -= Math.floor(x); y -= Math.floor(y); z -= Math.floor(z);
                let u = fade(x), v = fade(y), w = fade(z);
                let A = this.p[X]+Y, AA = this.p[A]+Z, AB = this.p[A+1]+Z,
                    B = this.p[X+1]+Y, BA = this.p[B]+Z, BB = this.p[B+1]+Z;
                return lerp(w, lerp(v, lerp(u, grad(this.p[AA  ], x  , y  , z   ), grad(this.p[BA  ], x-1, y  , z   )),
                                       lerp(u, grad(this.p[AB  ], x  , y-1, z   ), grad(this.p[BB  ], x-1, y-1, z   ))),
                               lerp(v, lerp(u, grad(this.p[AA+1], x  , y  , z-1 ), grad(this.p[BA+1], x-1, y  , z-1 )),
                                       lerp(u, grad(this.p[AB+1], x  , y-1, z-1 ), grad(this.p[BB+1], x-1, y-1, z-1 ))));
            };
        };
        // --- FIN: GENERADOR DE RUIDO PERLIN ---

        function initMesh() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(55, window.innerWidth / window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true, preserveDrawingBuffer: true });
            renderer.setClearColor(0x000000, 0);
            renderer.setSize(containerRect.width, containerRect.height);
            meshContainer.appendChild(renderer.domElement);

            const geometry = new THREE.PlaneGeometry(TERRAIN_PARAMS.width, TERRAIN_PARAMS.height, TERRAIN_PARAMS.segmentsX, TERRAIN_PARAMS.segmentsY);
            const material = new THREE.MeshBasicMaterial({ color: 0xE0E0E0, wireframe: true, transparent: true, opacity: 0.2 });
            mesh = new THREE.Mesh(geometry, material);
            scene.add(mesh);
            
            // ▼▼▼ AQUÍ ESTÁ EL CAMBIO ▼▼▼
            mesh.position.y = -20; //eo aca modifique para bajar la malla
            
            const positions = mesh.geometry.attributes.position.array;
            for (let i = 0; i < positions.length; i += 3) {
                const x = positions[i];
                const y = positions[i + 1];
                positions[i + 2] = noise.perlin3(x / TERRAIN_PARAMS.noiseFactor, y / TERRAIN_PARAMS.noiseFactor, 0) * TERRAIN_PARAMS.heightFactor;
            }
            mesh.geometry.attributes.position.needsUpdate = true;
            
            // Ajustamos la cámara para que el horizonte quede a la mitad
            camera.position.set(0, -12, 15); // Un poco más atrás y menos abajo
            camera.rotation.x = 0.01;   // el angulo se pronuncia más entre mas cerca este del 0
            // ▲▲▲ FIN DEL CAMBIO ▲▲▲

            meshContainer.addEventListener('mousemove', onDocumentMouseMove, false);
            meshContainer.addEventListener('click', onDocumentMouseClick, false);
            window.addEventListener('resize', onWindowResize, false);
        }

        function onDocumentMouseMove(event) {
            const rect = meshContainer.getBoundingClientRect();
            mouse.x = (event.clientX - rect.left) / rect.width;
            mouse.y = (event.clientY - rect.top) / rect.height;
        }
        
        function onDocumentMouseClick(event) {
             clickStrength = 1.5;
        }

        function onWindowResize() {
            containerRect = meshContainer.getBoundingClientRect();
            camera.aspect = containerRect.width / containerRect.height;
            camera.updateProjectionMatrix();
            renderer.setSize(containerRect.width, containerRect.height);
        }

        let time = 0;
        function animate() {
            requestAnimationFrame(animate);
            time += TERRAIN_PARAMS.animSpeed;
            clickStrength *= 0.95;
            
            const positions = mesh.geometry.attributes.position.array;
            for (let i = 0; i < positions.length; i += 3) {
                const x = mesh.geometry.attributes.position.getX(i);
                const y = mesh.geometry.attributes.position.getY(i);
                let z = noise.perlin3(x / TERRAIN_PARAMS.noiseFactor, y / TERRAIN_PARAMS.noiseFactor, time) * TERRAIN_PARAMS.heightFactor;
                const dx = (mouse.x * TERRAIN_PARAMS.width / 2 - TERRAIN_PARAMS.width / 4) - x;
                const dy = -(mouse.y * TERRAIN_PARAMS.height - TERRAIN_PARAMS.height / 2) - y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                z += Math.sin(distance * 2 - time * 10) * clickStrength;
                positions[i + 2] = z;
            }
            mesh.geometry.attributes.position.needsUpdate = true;
            
            camera.position.set(0.15 - mouse.x * 0.3, -12 + (mouse.y - 0.5) * 5, 15);
            camera.lookAt(0, 0, 0);
            renderer.render(scene, camera);
        }
        
        initMesh();
        animate();
    });
</script>
    <script>
        function initPageScripts() { }
        document.addEventListener('DOMContentLoaded', initPageScripts);
    </script>

    <script src="js/app.js"></script>
    <script src="js/loader.js"></script>
    <script src="js/transitions.js"></script>
    <script src="js/glitch-effect.js"></script>
</body>
</html>